<div class="container">
  <div class="row">
    <div class="col-sm-3">
    </div>
    <div class="col-sm-9">
      <%= form_for @query, url: filter_path, id: 'search-form', method: :get do |f| %>
        <% @query.selected_data_types.each do |dt| %>
          <%= f.hidden_field :selected_data_types, multiple: true, value: dt %>
        <% end %>
        <%= f.hidden_field :min_year %>
        <%= f.hidden_field :max_year %>
        <%= f.hidden_field :min_subjects %>
        <%= f.hidden_field :max_subjects %>
        <%= f.hidden_field :required_data %>
        <%= f.hidden_field :required_attachment %>
        <div class="form-group row">
          <div class="col-sm-9">
            <%= f.text_field :text_query, { class: 'form-control', placeholder: 'Search terms...' } %>
          </div>
          <%= f.submit 'Search', { class: 'btn btn-primary col-sm-2', method: :get } %>
        </div>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-3">
      <h4>Filters</h4>
      <h6 class="mt-3">Datatypes:</h6>
      <%= form_for @query, url: filter_path, method: :get do |f| %>
        <%= f.hidden_field :text_query %>
        <%= f.hidden_field :min_year %>
        <%= f.hidden_field :max_year %>
        <%= f.hidden_field :min_subjects %>
        <%= f.hidden_field :max_subjects %>
        <%= f.hidden_field :required_data %>
        <%= f.hidden_field :required_attachment %>
        <% @query.data_types.each do |dt| %>
          <div class="form-check">
            <%= f.check_box :selected_data_types,
                            { class: 'form-check-input', multiple: true, onChange: "this.form.submit();",
                              checked: dt.id.to_s.in?(@query.selected_data_types) }, dt.id, false %>
            <%= f.label :selected_data_types, dt.name, class: 'form-check-label' %>
          </div>
        <% end %>
      <% end %>
      <h6 class="mt-3">Years:</h6>
      <%= form_for @query, url: filter_path, method: :get do |f| %>
        <% @query.selected_data_types.each do |dt| %>
          <%= f.hidden_field :selected_data_types, multiple: true, value: dt %>
        <% end %>
        <%= f.hidden_field :text_query %>
        <%= f.hidden_field :min_subjects %>
        <%= f.hidden_field :max_subjects %>
        <%= f.hidden_field :required_data %>
        <%= f.hidden_field :required_attachment %>
        <div class="form-group row">
          <div class="col-sm-4">
            <%= f.text_field :min_year, class: 'form-control' %>
          </div>
          <label class="col-xs-1 col-form-label">to:</label>
          <div class="col-sm-4">
            <%= f.text_field :max_year, class: 'form-control' %>
          </div>
          <%= f.submit 'Go', { class: 'btn btn-primary col-sm-2', method: :get } %>
        </div>
      <% end %>
      <h6 class="mt-3">Subjects:</h6>
      <%= form_for @query, url: filter_path, method: :get do |f| %>
        <% @query.selected_data_types.each do |dt| %>
          <%= f.hidden_field :selected_data_types, multiple: true, value: dt %>
        <% end %>
        <%= f.hidden_field :text_query %>
        <%= f.hidden_field :min_year %>
        <%= f.hidden_field :max_year %>
        <%= f.hidden_field :required_data %>
        <%= f.hidden_field :required_attachment %>
        <div class="form-group row">
          <div class="col-sm-4">
            <%= f.text_field :min_subjects, class: 'form-control' %>
          </div>
          <label class="col-xs-1 col-form-label">to:</label>
          <div class="col-sm-4">
            <%= f.text_field :max_subjects, class: 'form-control' %>
          </div>
          <%= f.submit 'Go', { class: 'btn btn-primary col-sm-2', method: :get } %>
        </div>
      <% end %>
    </div>
    <div class="col-sm-9">
      <%= render 'studies/list', studies: @studies, searching: true %>
    </div>
  </div>
</div>
